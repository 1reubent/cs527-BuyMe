{% extends 'base.html' %}
{% block title %}Search Results{% endblock %}
{% block header %}
  <h1>Search</h1>
{% endblock %}
{% block content %}
  <form action="{{ url_for('search.search') }}"
        method="get"
        class="search-form">
    <input type="text"
           name="q"
           placeholder="Search auctions or users..."
           value="{{ query }}"
           class="search-input" />

    <select name="type" class="search-type">
      <option value="auction" {% if search_type == 'auction' %}selected{% endif %}>Auctions</option>
      <option value="user" {% if search_type == 'user' %}selected{% endif %}>Users</option>
    </select>

    <label>
      Category:
      <select name="category_id">
        <option value="">Any</option>
        {% for c in categories %}
          <option value="{{ c.category_id }}"
                  {% if selected_category_id == c.category_id %}selected{% endif %}>
            {{ c.category_name }}
          </option>
        {% endfor %}
      </select>
    </label>

    <label>
      Detail filter:
      <input type="text"
             name="detail_q"
             placeholder="e.g., Intel, 16GB, Blue"
             value="{{ detail_query }}" />
    </label>

    <button type="submit" class="fancy-btn">Search</button>
  </form>

  {% if search_type == 'user' %}
    <h2>User Results</h2>
    {% if results %}
      <ul>
        {% for u in results %}
          <li>
            <a href="{{ url_for('home.user_public', user_id=u.id) }}">{{ u.username }} ({{ u.f_name }} {{ u.l_name }})</a>
             - {{ u.user_type }}
          </li>
        {% endfor %}
      </ul>
    {% elif query %}
      <p>No users found.</p>
    {% endif %}
  {% else %}
    <h2>Auction Results</h2>
    {% if results %}
      <ul>
        {% for a in results %}
          <li>
            <a href="{{ url_for('auction.view', auction_id=a.auction_id) }}">
              {{ a.item_name }} - {{ a.auction_title }}
            </a>
            <br />
            <small>{{ a.category_name }} | {{ a.auction_start }} â†’ {{ a.auction_end }}</small>
            <br />
            <small>{{ a.auction_desc }}</small>
          </li>
        {% endfor %}
      </ul>
    {% elif query or selected_category_id or detail_query %}
      <p>No auctions found.</p>
    {% endif %}
  {% endif %}
{% endblock %}
